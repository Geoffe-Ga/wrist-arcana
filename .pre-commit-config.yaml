repos:
  - repo: local
    hooks:
      - id: swiftformat
        name: SwiftFormat (lint check)
        entry: swiftformat --lint .
        language: system
        types: [swift]
        pass_filenames: false
        stages: [pre-commit]

      - id: swiftlint
        name: SwiftLint (strict mode)
        entry: swiftlint lint --strict
        language: system
        types: [swift]
        pass_filenames: false
        stages: [pre-commit]

      - id: xcodebuild-build
        name: Xcode Build (Watch App target only)
        entry: bash -c 'xcodebuild build -project WristArcana/WristArcana.xcodeproj -target "WristArcana Watch App" -sdk watchsimulator -configuration Debug CODE_SIGNING_ALLOWED=NO 2>&1 | grep -E "(BUILD|SUCCEEDED|FAILED)" | tail -1'
        language: system
        pass_filenames: false
        stages: [pre-commit]

      - id: unit-tests
        name: Unit Tests (WristArcana Watch AppTests)
        entry: bash -c './scripts/run-tests.sh unit'
        language: system
        pass_filenames: false
        stages: [pre-push]

      - id: ui-tests-draw
        name: UI Tests (DrawCardViewResponsivenessUITests)
        entry: bash -c './scripts/run-tests.sh DrawCardViewResponsivenessUITests'
        language: system
        pass_filenames: false
        stages: [pre-push]

      - id: ui-tests-history
        name: UI Tests (WristArcanaWatchAppUITests)
        entry: bash -c './scripts/run-tests.sh WristArcanaWatchAppUITests'
        language: system
        pass_filenames: false
        stages: [pre-push]

      - id: coverage-check
        name: "Code Coverage ≥50% (goal: 60%+)"
        entry: bash
        args:
          - -c
          - |
            xcrun xccov view --report --json /tmp/TestResults.xcresult > /tmp/coverage.json
            COVERAGE=$(jq ".lineCoverage" /tmp/coverage.json)
            COVERAGE_PCT=$(echo "$COVERAGE * 100" | bc)
            echo "Coverage: ${COVERAGE_PCT}%"
            if (( $(echo "$COVERAGE < 0.50" | bc -l) )); then
              echo "❌ Coverage below 50% threshold (current: ${COVERAGE_PCT}%)"
              exit 1
            fi
            echo "✅ Coverage: ${COVERAGE_PCT}% (target: 60%+)"
        language: system
        pass_filenames: false
        stages: [pre-push]